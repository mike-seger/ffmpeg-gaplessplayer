<!DOCTYPE html>

<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>Gapless 5 - Demonstration Page</title>
  <meta name="viewport" content="width=400">
  <link rel="stylesheet" href="./files/gapless5.css" type="text/css">
  <script>
    document.write("<script type='text/javascript' src='./files/gapless5.js?v=" + Date.now() + "'><\/script>");
  </script>
  <script type="text/javascript" src="./files/gapless5.js"></script>

  <style type="text/css">

  body {
    font-family: Arial, Helvetica, Geneva, sans-serif;
    margin-left: 2em;
  }
  h1,h2,h3,h4,h5 {
    font-weight: 500;
    margin-bottom: .25em;
  }
  h4 {
    margin-top: 10px;
    margin-bottom: 10px;
  }
  a {
    text-decoration: none;
  }
  table {
    border: 1px solid #000;
    padding: 0 1em 1em 1em;
    width: 350px;
  }
  td {
    padding: 0;
    margin: 0;
  }
  table td:nth-child(1) {
    vertical-align: top;
    width: 200px;
  }
  table td:nth-child(2) {
    vertical-align: top;
    padding-left: 2em;
    width: 150px;
  }
  p {
    font-size: 75%;
  }
  ul, li {
    font-size: 80%;
    list-style-type: none;
    padding-left: 0;
    margin-bottom: 0;
  }

  </style>

</head>
<body>
  <h1>Gapless 5 - Demonstration Page</h1>
  <small>A gapless JavaScript/CSS audio player for HTML5
    <p>Learn more and download from <a href="https://github.com/regosen/Gapless-5">Github Page</a></p>
  </small>

  <table>
    <tbody><tr><td>
     <h4>Single Loop</h4>
     <span id="g5-drums1">
    <div class="g5positionbar" id="g5positionbar-g5-drums1">
      <span id="g5position-g5-drums1">00:00.00</span> |
      <span id="g5duration-g5-drums1">00:03.56</span> |
      <span id="g5index-g5-drums1">1</span>/<span id="g5numtracks-g5-drums1">1</span>
    </div>
    <div class="g5inside" id="g5inside-g5-drums1">
      
    <div class="g5transport">
      <div class="g5meter" id="g5meter-g5-drums1"><span id="g5loadedspan-g5-drums1" style="width: 0px;"></span></div>
      <input type="range" class="transportbar" name="transportbar" id="g5transportbar-g5-drums1" min="0" max="65535" value="0" oninput="gapless5Players[&#39;g5-drums1&#39;].scrub(this.value);" onmousedown="gapless5Players[&#39;g5-drums1&#39;].onStartedScrubbing();" ontouchstart="gapless5Players[&#39;g5-drums1&#39;].onStartedScrubbing();" onmouseup="gapless5Players[&#39;g5-drums1&#39;].onFinishedScrubbing();" ontouchend="gapless5Players[&#39;g5-drums1&#39;].onFinishedScrubbing();">
    </div>
    <div class="g5buttons" id="g5buttons-g5-drums1">
      <button class="g5button g5prev enabled" id="g5prev-g5-drums1"></button>
      <button class="g5button g5play enabled" id="g5play-g5-drums1"></button>
      <button class="g5button g5stop enabled" id="g5stop-g5-drums1"></button>
      <button class="g5button g5shuffle disabled" id="g5shuffle-g5-drums1"></button>
      <button class="g5button g5next enabled" id="g5next-g5-drums1"></button>
      <input type="range" id="g5volume-g5-drums1" class="volume" name="gain" min="0" max="65535" value="65535" oninput="gapless5Players[&#39;g5-drums1&#39;].setVolume(this.value / 65535);">
    </div>
  
    </div>
  </span>
    </td><td>
      <p>Keystrokes:</p>
      <ul>
        <li>1: cue</li>
        <li>2: play/pause</li>
        <li>3: stop</li>
        <hr>
        <li>s: speed toggle</li>
        <li>v: volume toggle</li>
      </ul>
    </td></tr>
    <tr><td colspan="2">
      <form>
        <p>Choose a file to replace the loop:</p>
        <input type="file" id="gapless-file-input" accept="audio/*">
      </form>
    </td></tr>
  </tbody></table>
  <br>
  <table>
    <tbody><tr><td>
     <h4>Crossfading Chords</h4>
     <span id="g5-synths">
    <div class="g5positionbar" id="g5positionbar-g5-synths">
      <span id="g5position-g5-synths">00:00.00</span> |
      <span id="g5duration-g5-synths">00:03.55</span> |
      <span id="g5index-g5-synths">1</span>/<span id="g5numtracks-g5-synths">3</span>
    </div>
    <div class="g5inside" id="g5inside-g5-synths">
      
    <div class="g5transport">
      <div class="g5meter" id="g5meter-g5-synths"><span id="g5loadedspan-g5-synths" style="width: 0px;"></span></div>
      <input type="range" class="transportbar" name="transportbar" id="g5transportbar-g5-synths" min="0" max="65535" value="0" oninput="gapless5Players[&#39;g5-synths&#39;].scrub(this.value);" onmousedown="gapless5Players[&#39;g5-synths&#39;].onStartedScrubbing();" ontouchstart="gapless5Players[&#39;g5-synths&#39;].onStartedScrubbing();" onmouseup="gapless5Players[&#39;g5-synths&#39;].onFinishedScrubbing();" ontouchend="gapless5Players[&#39;g5-synths&#39;].onFinishedScrubbing();">
    </div>
    <div class="g5buttons" id="g5buttons-g5-synths">
      <button class="g5button g5prev enabled" id="g5prev-g5-synths"></button>
      <button class="g5button g5play enabled" id="g5play-g5-synths"></button>
      <button class="g5button g5stop enabled" id="g5stop-g5-synths"></button>
      <button class="g5button g5shuffle enabled" id="g5shuffle-g5-synths"></button>
      <button class="g5button g5next enabled" id="g5next-g5-synths"></button>
      <input type="range" id="g5volume-g5-synths" class="volume" name="gain" min="0" max="65535" value="65535" oninput="gapless5Players[&#39;g5-synths&#39;].setVolume(this.value / 65535);">
    </div>
  
    </div>
  </span>
    </td><td>
      <p>Keystrokes:</p>
      <ul>
        <li>6: prev track</li>
        <li>7: cue</li>
        <li>8: play/pause</li>
        <li>9: stop</li>
        <li>0: next track</li>
        <hr>
        <li>c: crossfade toggle</li>
        <li>s: speed toggle</li>
        <li>v: volume toggle</li>
        <li>q: queue 3rd track</li>
      </ul>
    </td></tr>
  </tbody></table>
  <br>
  <table>
    <tbody><tr><td>
     <h4>Seamless Album</h4>
     <span id="g5-album">
    <div class="g5positionbar" id="g5positionbar-g5-album" style="width: 115px;">
      <span id="g5position-g5-album">01:38.55</span> |
      <span id="g5duration-g5-album">05:12.79</span> |
      <span id="g5index-g5-album">11</span>/<span id="g5numtracks-g5-album">12</span>
    </div>
    <div class="g5inside" id="g5inside-g5-album" style="width: 115px;">
      
    <div class="g5transport">
      <div class="g5meter" id="g5meter-g5-album" style="width: 111px;"><span id="g5loadedspan-g5-album" style="width: 0%"></span></div>
      <input type="range" class="transportbar" name="transportbar" id="g5transportbar-g5-album" min="0" max="65535" value="0" oninput="gapless5Players[&#39;g5-album&#39;].scrub(this.value);" onmousedown="gapless5Players[&#39;g5-album&#39;].onStartedScrubbing();" ontouchstart="gapless5Players[&#39;g5-album&#39;].onStartedScrubbing();" onmouseup="gapless5Players[&#39;g5-album&#39;].onFinishedScrubbing();" ontouchend="gapless5Players[&#39;g5-album&#39;].onFinishedScrubbing();" style="width: 111px;">
    </div>
    <div class="g5buttons" id="g5buttons-g5-album">
      <button class="g5button g5prev enabled" id="g5prev-g5-album"></button>
      <button class="g5button g5play enabled" id="g5play-g5-album"></button>
      <button class="g5button g5stop enabled" id="g5stop-g5-album"></button>
      
      <button class="g5button g5next enabled" id="g5next-g5-album"></button>
      <input type="range" id="g5volume-g5-album" class="volume" name="gain" min="0" max="65535" value="65535" oninput="gapless5Players[&#39;g5-album&#39;].setVolume(this.value / 65535);">
    </div>
  
    </div>
  </span>
     <p>
      Title: <span id="album-title">Headphones</span><br>
      Artist: Rego Sen<br>
      Album: Observer<br>
      Year: 2000<br>
     </p>
    </td><td>
      <p>Note: not every track has a transition.  Click below to read more about the album.</p>
      <p>
        <a href="https://ccrma.stanford.edu/~regosen/index-music.htm#obs" target="_blank"><img src="./files/observer-cover-small.jpg" width="110"></a>
      </p>
    </td></tr>
  </tbody></table>

  <script type="text/javascript"><!--
    const logLevel = LogLevel.Debug;
    const crossfadeMS = 500;
    const crossfadeShortMS = 25;
    let speedToggle = false;
    let volumeToggle = false;

    const isCharI = (keyCode, char) => 
      keyCode === char.toLowerCase().charCodeAt(0) || keyCode === char.toUpperCase().charCodeAt(0);

    document.addEventListener('keydown', (e) => {
      const keyCode = e.key.charCodeAt(0);
      if (isCharI(keyCode, 's')) {
        speedToggle = !speedToggle;
        singlePlayer.setPlaybackRate(speedToggle ? 1.5 : 1);
        multiPlayer.setPlaybackRate(speedToggle ? 0.75 : 1);
      } else if (isCharI(keyCode, 'v')) {
        volumeToggle = !volumeToggle;
        singlePlayer.setVolume(volumeToggle ? 0.25 : 1);
        multiPlayer.setVolume(volumeToggle ? 0.25 : 1);
      } else if (isCharI(keyCode, 'q')) {
        multiPlayer.queueTrack(2);
      } else if (isCharI(keyCode, 'c')) {
        multiPlayer.setCrossfade(multiPlayer.crossfade === crossfadeMS ? 0 : crossfadeMS);
      }
    });

    const singlePlayer = new Gapless5({
      guiId: 'g5-drums1',
      loop: true,
      tracks: 'psounds/Drumloop.wav',
      logLevel,
      mapKeys: {cue: '1', playpause: '2', stop: '3'},
      layout: { fontFamily: 'Courier', fontSize: '8px', hidePositionText: true },
    });

    document.getElementById('gapless-file-input').onchange = function() {
      const file = this.files[0];
      if (file) {
        singlePlayer.removeAllTracks();
        singlePlayer.addTrack(URL.createObjectURL(file));
      }
    };

    const multiPlayer = new Gapless5({
      //useWebAudio: false,
      guiId: 'g5-synths',
      loop: true,
      crossfade: crossfadeMS,
      crossfadeShape: CrossfadeShape.EqualPower,
      tracks: ['psounds/Synth1.wav', 'psounds/Synth4.wav'],
      logLevel,
      mapKeys: {prevtrack: '6', cue: '7', playpause: '8', stop: '9', next: '0'},
    });
    multiPlayer.insertTrack(1, 'psounds/Synth2.wav');

    // pressing play while loading doesn't queue play without HTML5Audio
    const localMode = true;
    const albumPlayer = new Gapless5({
      guiId: 'g5-album',
      tracks: [
        'alpha - space dream - 01. das licht - traumwelten',
        'alpha - space dream - 02. vectrex - meteor (armageddon club mix)',
        'alpha - space dream - 03. jupiter prime - gate to heaven',
        'alpha - space dream - 04. armin - communication',
      ].map(file => localMode ? `../../tracks/${file}.flac` : `../mp3/observer-seamless/${file}.mp3`),
      logLevel,
      shuffleButton: false,
      crossfade: crossfadeShortMS,
      loadLimit: 2,
    });

    const updateAlbumTitle = () => {
      const [ title ] = albumPlayer.currentSource().audioPath.split(' - ')[1].split('.');
      document.getElementById('album-title').innerHTML = title;
    };
    updateAlbumTitle();
    albumPlayer.onprev = updateAlbumTitle;
    albumPlayer.onnext = updateAlbumTitle;

  --></script>


</body></html>